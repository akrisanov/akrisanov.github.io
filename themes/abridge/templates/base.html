{%- import 'macros/seo.html' as macros_seo %}
{%- import "macros/macros.html" as macros %}
{# Load current language i18n data from .toml files in user's '/i18n' folder, use theme as fallback. #}
{%- set i18n = load_data(path="i18n/" ~ lang ~ '.toml', required=false) -%}
{%- if not i18n -%}{%- set i18n = load_data(path="themes/abridge/i18n/" ~ lang ~ ".toml", required=false) -%}{%- endif %}

{%- set uglyurls = config.extra.uglyurls | default(value=false) -%}
{%- if config.extra.search_library %}{%- if config.extra.search_library == "offline" %}{% set uglyurls = true %}{% endif %}{% endif %}
<!DOCTYPE html>
<html lang="{%- if lang != config.default_language %}{{ lang }}{% else %}{{ config.extra.language_code | default(value=lang) }}{% endif %}">
<head>
  {%- include "partials/head.html" %}

  {#- SEO: title, description, etc #}
  {%- block seo %}
    {%- if config.extra.title_separator %}
      {%- set title_separator = " " ~ config.extra.title_separator ~ " " -%}
    {%- else %}
      {%- set title_separator = " | " -%}
    {%- endif %}
  {%- endblock seo %}

  {%- block comments_init %}
  {%- endblock comments_init %}

  {%- include "partials/head_js.html" %}
  {# Optional: apply a body font class based on config.extra.font_family ("sans", "serif", "serif-modern") #}
  <script>
    (function(){
      try {
        var pref = "{{ config.extra.font_family | default(value="") }}";
        if (pref) {
          document.documentElement.classList.add('js');
          document.addEventListener('DOMContentLoaded', function(){
            document.body.classList.add(pref);
          });
        }
      } catch(e){}
    })();
  </script>
</head>
<body>
{%- block header %}
  <a class="visually-hidden" href="#main-content">Skip to content</a>
  <header>
    <nav>
      <div>
        {%- if config.extra.logo -%}

        <h1><a href="{{ get_url(path="/", lang=lang) }}{%- if uglyurls %}/index.html{%- endif %}" title="{{config.title}}">
        {%- if config.extra.logo.file -%}
        <img src="{{ config.base_url | safe }}/{{ config.extra.logo.file | safe }}"{%- if config.extra.logo.alt %} alt="{{ config.extra.logo.alt | safe }}"{%- endif %}{%- if config.extra.logo.width %} width="{{ config.extra.logo.width | safe }}"{%- endif %}{%- if config.extra.logo.height %} height="{{ config.extra.logo.height | safe }}"{%- endif %} />
        {%- endif -%}
        {%- if config.extra.logo.text -%}{{ config.extra.logo.text | safe }}{%- endif -%}
        </a></h1>

        {%- elif config.extra.textlogo -%}
  <h1><a href="{{ get_url(path="/", lang=lang) }}{%- if uglyurls -%}
  {%- if lang == config.default_language -%}/{%- endif -%}
  index.html{%- endif -%}" title="{{config.title}}"><big>{{ config.extra.textlogo | safe }}</big></a></h1>
        {%- elif config.title -%}
  <h1><a href="{{ get_url(path="/", lang=lang) }}{%- if uglyurls %}/index.html{%- endif %}" title="{{config.title}}"><big>{{ config.title | safe }}</big></a></h1>
        {%- endif -%}
      </div>
      <div>

        <div>
          <ul>

            {%- set js_switcher=config.extra.js_switcher | default(value=true) %}
            {%- if config.extra.menu %}
              {%- for i in config.extra.menu -%}
                {%- set link_url = "" -%}
                {%- if i.url is matching("^http[s]?://") -%}
                  {%- set link_url = i.url -%}
                {%- else -%}
                  {%- set link_url = get_url(path=i.url, lang=lang, trailing_slash=i.slash) -%}
                  {%- if i.slash and uglyurls -%}
                    {%- set link_url = link_url ~ "index.html" -%}
                  {%- endif -%}
                {%- endif -%}
                {%- if current_url -%}
                  {%- set current_url_norm = current_url | replace(from='/index.html', to='/') -%}
                  {%- set link_url_norm = link_url | replace(from='/index.html', to='/') -%}
                {%- endif -%}
                {%- if lang != config.default_language -%}
                  {%- set menu_label = macros::translate(key=i.name|safe, default=i.name|safe, i18n=i18n) -%}
                {%- else -%}
                  {%- set menu_label = i.name | safe -%}
                {%- endif -%}
                <li><a{%- if i.size %} class="{{ i.size }}"{% endif %} href="{{ link_url | safe }}"
                  {% if i.blank %} target="_blank" rel="noopener noreferrer"{% endif %}
                  {%- if current_url and current_url_norm == link_url_norm -%} aria-current="page"{%- endif -%}>
                {%- if i.icon %}
                <i class="fa fa-{{ i.icon }}" aria-hidden="true"></i>
                <span class="nav-label">{{ menu_label | safe }}</span>
                {% else %}
                {{ menu_label | safe }}
                {% endif %}
                </a></li>
              {%- endfor -%}
            {%- endif -%}

            {%- if config.languages | length > 0 %}
            {%- set language_label = macros::translate(key="language_name", default="lang_name", i18n=i18n) -%}
            <li><div class="dropdown"><button type="button" class="header-chip header-chip-icon" aria-label="{{ language_label }}" title="{{ language_label }}"><i class="svgs world" aria-hidden="true"></i><span>{{ language_label }}</span></button>
              {%- if current_url %}
                <div class="dropdown-content">
                <span>{{ language_label }}</span>
                {%- for lcode,language in config.languages -%}
                  {%- set i18n_menu = load_data(path="i18n/" ~ lcode ~ '.toml', required=false) -%}
                  {%- if not i18n_menu -%}{%- set i18n_menu = load_data(path="themes/abridge/i18n/" ~ lcode ~ ".toml", required=false) -%}{%- endif %}
                  {%- if lang != lcode -%}
                    {%- if lcode == config.default_language -%}
                    <a href="{{ current_url | replace(from='/' ~ lang ~ '/', to = '/') | safe }}{%- if uglyurls %}index.html{%- endif %}">{{ macros::translate(key="language_name", default="language_name", i18n=i18n_menu) }}</a>
                    {%- elif lang == config.default_language -%}
                    <a href="{{ current_url | replace(from=config.base_url, to=config.base_url ~ "/" ~ lcode) | safe }}{%- if uglyurls %}index.html{%- endif %}">{{ macros::translate(key="language_name", default="language_name", i18n=i18n_menu) }}</a>
                    {%- else -%}
                    <a href="{{ current_url | replace(from='/' ~ lang ~ '/', to = '/' ~ lcode ~ '/') | safe }}{%- if uglyurls %}index.html{%- endif %}">{{ macros::translate(key="language_name", default="language_name", i18n=i18n_menu) }}</a>
                    {%- endif -%}
                  {%- endif -%}
                {%- endfor -%}
                </div>
              {%- endif %}
            </div></li>
            {%- endif %}

            {%- if js_switcher -%}
              {%- set icon_adjust=config.extra.icon_adjust | default(value="svgs adjust") -%}
              {%- set switch_mode_label = "Theme" -%}
              {%- if lang != config.default_language -%}
                {%- set switch_mode_label = macros::translate(key="Theme"|safe, default="Theme"|safe, i18n=i18n) -%}
              {%- endif -%}
              {%- if icon_adjust -%}
          <li>
          <button type="button" id="mode" class="js header-chip header-chip-icon"
            title="{{ switch_mode_label | safe }}"
            aria-label="{{ switch_mode_label | safe }}"><i class="{{ icon_adjust }}" aria-hidden="true"></i><span>{{ switch_mode_label | safe }}</span></button>
              {%- else -%}
          <button type="button" id="mode" class="js header-chip header-chip-icon mode"
            title="{{ switch_mode_label | safe }}"
            aria-label="{{ switch_mode_label | safe }}"><span aria-hidden="true">&#9728;</span><span>{{ switch_mode_label | safe }}</span></button></li>
              {%- endif -%}
            {%- endif -%}

          </ul>
        </div>

        <div>
          {%- if config.build_search_index %}
          {%- set icon_search=config.extra.icon_search | default(value="svgs search") %}
          <div>
            <form autocomplete=off class="js" name="goSearch" id="searchbox" role="search" aria-label="{{ macros::translate(key="Search", default="Search", i18n=i18n) }}">
              <div class="searchd">
      <input id="searchinput" type="text" placeholder="{{ macros::translate(key="Search", default="Search", i18n=i18n) }}"
        aria-label="{{ macros::translate(key="Search", default="Search", i18n=i18n) }}" title="{{ macros::translate(key="Search", default="Search", i18n=i18n) }}" />
                <button type="submit" title="{{ macros::translate(key="Search", default="Search", i18n=i18n) }}" aria-label="{{ macros::translate(key="Search", default="Search", i18n=i18n) }}" class="{%- if icon_search -%}{{ icon_search }}{%- else -%}si{%- endif -%}">{%- if not icon_search -%}&#8981;{%- endif -%}</button>
              </div>
              <div class="results" aria-live="polite"><div id="suggestions"></div></div>
            </form>
          </div>
          {%- endif %}
        </div>

      </div>
    </nav>
    {%- if config.extra.sitedesc %}
    {%- if config.description %}
    <div class="desc">{{ config.description }}</div>
    {%- endif %}
    {%- endif %}
    {%- if config.extra.headhr %}
    <hr />
    {%- endif %}
  </header>
{%- endblock header %}
  <main id="main-content">
  {%- block content %}
  {%- endblock content %}
  </main>
{%- block footer %}
  <footer>
    {%- if config.extra.foothr %}
    <hr />
    {%- endif %}
    <div class="c">
      {%- include "partials/social.html" %}

      {#- Copyright START #}
      {%- if config.extra.copyright | default(value=true) -%}
      {%- set current_year = now() | date(format="%Y") %}
      {%- set current_year = '<span id="year">' ~ current_year ~ '</span>' %}

        {%- if config.extra.copyright_override -%}
          {%- if lang != config.default_language %}
            {%- set copyright_string = macros::translate(key='copyright_override', default='Â© $CURRENT_YEAR $SITE_TITLE', i18n=i18n) | replace(from="$CURRENT_YEAR", to=current_year) | replace(from="$SITE_TITLE", to=config.title) %}
          {% else %}
            {%- set copyright_string = config.extra.copyright_override | replace(from="$CURRENT_YEAR", to=current_year) | replace(from="$SITE_TITLE", to=config.title) %}
          {% endif -%}
        {%- else -%}
          {%- set copyright_string = "&copy; " ~ current_year ~ " " ~ config.title %}
        {%- endif %}
      <p{%- if config.extra.footer_size %} class="{{ config.extra.footer_size }}"{% endif %}> {{ copyright_string | safe }}</p>
      {%- endif -%}
      {#- Copyright END #}

      {%- if config.extra.menu_footer %}
      <nav>
        {%- for i in config.extra.menu_footer -%}
          {%- if i.url is starting_with("https://") %}
            {%- set furl=i.url %}
          {%- else %}
            {%- if i.url != "sitemap.xml" %}
              {%- set furl=get_url(path=i.url, lang=lang, trailing_slash=i.slash) %}
            {%- else %}
              {%- set furl=get_url(path=i.url, trailing_slash=i.slash) %}
            {%- endif %}
          {%- endif %}
          <a{%- if config.extra.footer_size %} class="{{ config.extra.footer_size }}"{% endif %}
            href="{{ furl | safe }}{%- if i.slash and uglyurls %}index.html{%- endif %}"
            {% if i.blank %} target="_blank" rel="noopener noreferrer"{% endif %}
            aria-label="{% if lang != config.default_language %} {{ macros::translate(key=i.name|safe, default=i.name|safe, i18n=i18n) }} {% else %} {{ i.name | safe }} {% endif %}"
          ><i class="fa fa-{{ i.icon }}" aria-hidden="true" title="{% if lang != config.default_language %} {{ macros::translate(key=i.name|safe, default=i.name|safe, i18n=i18n) }} {% else %} {{ i.name | safe }} {% endif %}"></i></a>
        {%- endfor %}
      </nav>
      {%- endif %}
      {%- if config.extra.footer_credit | default(value=true) %}
      {%- if config.extra.footer_credit_override %}
      {{ config.extra.footer_credit_override | safe }}
      {%- else %}
  <p{%- if config.extra.footer_size %} class="{{ config.extra.footer_size }}"{% endif %}>{{ macros::translate(key="Powered_by", default="Powered by", i18n=i18n) }} <a href="https://www.getzola.org/" target="_blank" rel="noopener noreferrer">Zola</a> {{ macros::translate(key="and", default="and", i18n=i18n) }} <a href="https://github.com/jieiku/abridge/" target="_blank" rel="noopener noreferrer">Abridge</a></p>
      {%- endif %}
      {%- endif %}
    </div>
  </footer>
{%- endblock footer %}
{%- block gotop %}
{%- endblock gotop %}
</body>
</html>

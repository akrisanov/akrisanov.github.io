
<!DOCTYPE html>
<html lang="en">
<head>
<script src="https://akrisanov.com/js/theme.min.js" integrity="sha384-pb++s6uBRKaQv+iAXpgA/H3IlpLZdO14tTwuCI7uXmz4aaZdByoCcM+6BhynMq/1"></script>
<link rel="stylesheet"
  href="https://akrisanov.com/abridge.css?h=7cb460406165e24193ad" />
<meta charset="utf-8" />
<meta http-equiv="x-ua-compatible" content="ie=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="base" content="https://akrisanov.com" />

<meta name="content-language" content="en" />
<meta name="HandheldFriendly" content="True" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="theme-color" content="#333333" />
<meta name="msapplication-TileColor" content="#333333" />
<link rel="manifest" href="https://akrisanov.com/manifest.min.json" />
<link rel="mask-icon" href="https://akrisanov.com/safari-pinned-tab.svg"
  color="#ff9900" />
<link rel="icon" type="image/svg+xml"
  href="https://akrisanov.com/favicon.png" />
<link rel="apple-touch-icon" sizes="180x180"
  href="https://akrisanov.com/apple-touch-icon.png" />
<link rel="preload" as="style" class="preStyle" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous" />
<link rel="alternate" type="application/atom+xml" title="Andrey Krisanov Atom Feed"
  href="https://akrisanov.com/atom.xml" />
<link rel="alternate" type="application/rss+xml" title="Andrey Krisanov RSS Feed"
  href="https://akrisanov.com/rss.xml" /> <meta name="robots" content="index, follow" />
<meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
<meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
<title>Synchronizing Users From LDAP With Keycloak Using AD Filters | Andrey Krisanov</title>
<meta name="author" content="Andrey Krisanov" />
<meta name="copyright" content="Andrey Krisanov" />
<meta name="description" content="Keycloak allows configuring a custom LDAP user filter for User Federation to select a subset of user entries in Active Directory." />
<link rel="canonical" href="https://akrisanov.com/custom-user-ldap-filter-in-keycloak/" />
<link rel="alternate" hreflang="en" href="https://akrisanov.com/custom-user-ldap-filter-in-keycloak/" />
<link rel="alternate" hreflang="x-default" href="https://akrisanov.com/custom-user-ldap-filter-in-keycloak/" />
<meta name="keywords" content="keycloak, ldap, active-directory, AI infrastructure, inference engineering, LLM serving, distributed systems, scalable backend, performance optimization, reliability, observability, MLOps, DevOps, GPU inference, model serving, vLLM, Triton Inference Server, Ray Serve, .NET, C#, Python, Kubernetes, Docker, Terraform, Ansible, OpenTelemetry, Grafana, CI&#x2F;CD, cloud infrastructure, platform engineering" />
<meta name="google-site-verification" content="Your Google Site verification code." />
<meta name="msvalidate.01" content="Your Bing Site verification code." />
<meta property="og:url" content="https://akrisanov.com/custom-user-ldap-filter-in-keycloak/" />
<meta name="twitter:url" content="https://akrisanov.com/custom-user-ldap-filter-in-keycloak/" />
<meta property="og:description" content="Keycloak allows configuring a custom LDAP user filter for User Federation to select a subset of user entries in Active Directory." />
<meta name="twitter:description" content="Keycloak allows configuring a custom LDAP user filter for User Federation to select a subset of user entries in Active Directory." />
<meta property="og:title" content="Synchronizing Users From LDAP With Keycloak Using AD Filters | Andrey Krisanov" />
<meta name="twitter:title" content="Synchronizing Users From LDAP With Keycloak Using AD Filters | Andrey Krisanov" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://akrisanov.com/images/photo.png" />
<meta property="og:image" content="https://akrisanov.com/images/photo.png" />
<meta property="og:site_name" content="Andrey Krisanov" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="website" />
<meta property="og:updated_time" content="2023-09-23" />
<meta name="twitter:site" content="@_akrisanov" />
<meta name="twitter:creator" content="@_akrisanov" /><script type="application/ld+json">
{
	"@context": "https://schema.org",
	"@type": "Article",
	"headline": "Synchronizing Users From LDAP With Keycloak Using AD Filters",
	"url": "https://akrisanov.com/custom-user-ldap-filter-in-keycloak/",
	"inLanguage": "en",
	"author": {
		"@type": "Person",
		"name": "Andrey Krisanov"
	},
	"image": "https://akrisanov.com/images/photo.png",
	"datePublished": "2023-09-23T00:00:00+00:00",
	"dateModified": "2023-09-23T00:00:00+00:00"}
</script>
<script defer
  src="https://akrisanov.com/js/abridge.min.js?h=1a12cf684ae4ed40434f" integrity="sha384-ZsreuwU2rKTp7gC4bTf5sYz+3AjMym99XDa/B5wa08fCzLVVX+NDaTsTeyLXseDG"></script>
<noscript>
  <link rel="stylesheet" href="https://akrisanov.com/nojs.css" />
</noscript>
  
  <script>
    (function(){
      try {
        var pref = "";
        if (pref) {
          document.documentElement.classList.add('js');
          document.addEventListener('DOMContentLoaded', function(){
            document.body.classList.add(pref);
          });
        }
      } catch(e){}
    })();
  </script>
</head>
<body>
  <a class="visually-hidden" href="#main-content">Skip to content</a>
  <header>
    <nav>
      <div><h1><a href="https://akrisanov.com" title="Andrey Krisanov"><big>Andrey Krisanov</big></a></h1></div>
      <div>

        <div>
          <ul><li><a class="s95" href="https://akrisanov.com/about/"
                  > About 
                </a></li><li><a class="s95" href="https://akrisanov.com/archive/"
                  >
                <i class="fa fa-bookmark" aria-hidden="true" title="Posts"></i>
                
                </a></li>
            <li><div class="dropdown"><i class="svgs world" type="reset" role="button" tabindex="0" aria-label="English"></i>
                <div class="dropdown-content">
                <span>English</span><a href="https://akrisanov.com/ru/custom-user-ldap-filter-in-keycloak/">Русский</a></div>
            </div></li><li>
          <i type="reset" id="mode" class="js svgs adjust" role="button" tabindex="0"
            title="Switch Mode"
            aria-label="Switch Mode"></i></ul>
        </div>

        <div>
          <div>
            <form autocomplete=off class="js" name="goSearch" id="searchbox" role="search" aria-label="Search">
              <div class="searchd">
      <input id="searchinput" type="text" placeholder="Search"
        aria-label="Search" title="Search" />
                <button type="submit" title="Search" aria-label="Search" class="svgs search"></button>
              </div>
              <div class="results" aria-live="polite"><div id="suggestions"></div></div>
            </form>
          </div>
        </div>

      </div>
    </nav>
  </header>
  <main id="main-content">
<article>
<h1><a href="https://akrisanov.com/custom-user-ldap-filter-in-keycloak/">Synchronizing Users From LDAP With Keycloak Using AD Filters</a></h1>

<span class="s95" > September 23, 2023<span class="hpad">·</span> #<a
    href="https://akrisanov.com/tags/keycloak/">keycloak</a> </span>  <p>One of the ways to synchronize users via a third-party provider with Keycloak is a mechanism
called User Federation. It allows, using Kerberos or LDAP protocol, to pull user entries from your
corporate authentication storage. However, if your organization is big enough to have a complex
structure and there are a lot of users in the user directory, it could be challenging to get only
a subset of the accounts that belong to different organization units.</p>
<p>For example, Active Directory models a tree-based structure using the following entities:</p>
<ul>
<li><code>CN</code> = Common Name</li>
<li><code>OU</code> = Organizational Unit</li>
<li><code>DC</code> = Domain Component</li>
</ul>
<p>All the distinguished names can be found in <a rel="noopener" target="_blank" href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/ldap/distinguished-names">the official documentation</a>
provided by Microsoft.</p>
<p>To configure a new User Federation in Keycloak, it's required to specify a User DN.
This distinguished name is the base object in the directory information tree where the search
begins forming candidates for pulling authentication entries. Therefore, we need to know how to
construct the User DN.</p>
<p>The base option that an Active Directory administrator could use to create user accounts is to
organize them under organizational units:</p>
<pre data-lang="cfg" style="background-color:#3b224c;color:#dbbfef;" class="language-cfg "><code class="language-cfg" data-lang="cfg"><span style="color:#efba5d;">OU</span><span style="color:#eccdbb;">=</span><span>Main</span><span style="color:#eccdbb;">,</span><span style="color:#efba5d;">DC</span><span style="color:#eccdbb;">=</span><span>Orgname</span><span style="color:#eccdbb;">,</span><span style="color:#efba5d;">DC</span><span style="color:#eccdbb;">=</span><span>ru
</span></code></pre>
<p>Even if your organizational unit has a complex structure, it's still relatively easy for Keycloak
to find user entries inside it – just activate the <code>Search Scope: Subtree</code> setting when configuring
the user federation. In large organizations, the Active Directory structure can get quite messy.
Instead of using clear distinguished names, administrators do something surprising even to them.
How about putting entries under CN in different organizational units?</p>
<p>This is what I encountered while working on corporate user authentication for a media platform's CMS.
User entries of the editors were grouped via the Common Name. So, there is no way to define User DN
in the way I've mentioned in the example above. Fortunately, the LDAP connection allows providing
a filter for Active Directory. In my case, writing the filter to select all of the members of the
<code>CMS_EDITOR</code> group was enough to solve a problem:</p>
<pre data-lang="cfg" style="background-color:#3b224c;color:#dbbfef;" class="language-cfg "><code class="language-cfg" data-lang="cfg"><span>(&amp;(objectCategory</span><span style="color:#eccdbb;">=</span><span>Person)(sAMAccountName</span><span style="color:#eccdbb;">=*</span><span>)(</span><span style="color:#eccdbb;">|</span><span>(memberOf</span><span style="color:#eccdbb;">=</span><span style="color:#efba5d;">CN</span><span style="color:#eccdbb;">=</span><span style="color:#efba5d;">CMS_EDITOR</span><span style="color:#eccdbb;">,</span><span style="color:#efba5d;">OU</span><span style="color:#eccdbb;">=</span><span>Security</span><span style="color:#eccdbb;">,</span><span style="color:#efba5d;">OU</span><span style="color:#eccdbb;">=</span><span>Groups</span><span style="color:#eccdbb;">,</span><span style="color:#efba5d;">OU</span><span style="color:#eccdbb;">=</span><span>Central</span><span style="color:#eccdbb;">,</span><span style="color:#efba5d;">OU</span><span style="color:#eccdbb;">=</span><span>Main</span><span style="color:#eccdbb;">,</span><span style="color:#efba5d;">DC</span><span style="color:#eccdbb;">=</span><span>Orgname</span><span style="color:#eccdbb;">,</span><span style="color:#efba5d;">DC</span><span style="color:#eccdbb;">=</span><span>ru)))
</span></code></pre>
<p>Moreover, the <code>Custom User LDAP Filter</code> setting in Keycloak supports logical operators like <em>or</em>
with <code>|</code>, and I could use it for finding not only the members of the editor staff but also
CMS admins, guests, etc.</p>

    <nav>
      <div>
        <a href="https://akrisanov.com/using-github-actions-to-generate-a-lockfile-for-python-project/">&#8249; Generating A Lockfile For Python Project Using Github Actions</a>
      </div>
      <div>
        <a href="https://akrisanov.com/understand-how-services-are-run-and-operate-in-production/"> Understand How Services Are Run And Operate In Production &#8250;</a>
      </div>
    </nav>
</article>
  </main>
  <footer>
    <hr />
    <div class="c">
<nav class="tpad">
    <div></div>
</nav>
          
      <p class="s90"> © <span id="year">2025</span> Andrey Krisanov</p>
      <nav>
          <a class="s90"
            href="https://akrisanov.com/atom.xml"
             target="_blank" rel="noopener noreferrer"
            aria-label=" RSS "
          ><i class="fa fa-rss" aria-hidden="true" title=" RSS "></i></a>
          <a class="s90"
            href="https://akrisanov.com/sitemap.xml"
             target="_blank" rel="noopener noreferrer"
            aria-label=" Sitemap "
          ><i class="fa fa-sitemap" aria-hidden="true" title=" Sitemap "></i></a>
          <a class="s90"
            href="https://akrisanov.com/links"
             target="_blank" rel="noopener noreferrer"
            aria-label=" Contacts "
          ><i class="fa fa-address-card" aria-hidden="true" title=" Contacts "></i></a>
          <a class="s90"
            href="https://www.linkedin.com/in/akrisanov/"
             target="_blank" rel="noopener noreferrer"
            aria-label=" LinkedIn "
          ><i class="fa fa-linkedin" aria-hidden="true" title=" LinkedIn "></i></a>
          <a class="s90"
            href="https://github.com/akrisanov/"
             target="_blank" rel="noopener noreferrer"
            aria-label=" Github "
          ><i class="fa fa-github" aria-hidden="true" title=" Github "></i></a>
      </nav>
    </div>
  </footer>
</body>
</html>
